<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>移动ERP</title>
		<link rel="apple-touch-icon-precomposed" sizes="57x57" href="img/icon.png">
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/icon.png">
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/icon.png">
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/icon.png">
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Cache-Control" content="no-cache,no-store" />
		<meta http-equiv="Expires" content="0" />
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="white" name="apple-mobile-web-app-status-bar-style">
		<meta content="telephone=no" name="format-detection">
		<meta name="x5-fullscreen" content="true">
		<meta name="full-screen" content="yes">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<script type="text/javascript" src="js/AMD.js" ></script>
		<style id="ifWxStyle">
			.menuListShow{
				-webkit-filter: blur(3px);
			}
		</style>
		<style id="androidTransitionStyle">
			nav.menuNavMenu{
				transition:-webkit-transform 0.4s;
				-webkit-transition:-webkit-transform 0.4s;
			}
			nav.navMenu{
				transition:-webkit-transform 0.4s;
				-webkit-transition:-webkit-transform 0.4s;
			}
		</style>
	</head>
	<body>
		<div>
			<style>
				.loginFormDiv{
					width: 100%;
					height: calc(100% - 67px);
				}
				.loginFormDiv>ul{
					margin-top: 20px;
					height: auto;
				}
				.loginFormDiv>ul>li{
					font-size: 16px;
				}
				.loginFormDiv>ul>li:last-child{
					margin-top: 10px;
				}
				.loginFormDiv>ul>li>span{
					width: 60%;
					height: 100%;
					display: block;
					position: absolute;
					top: 0px;
					right: 0px;
					font-size: 16px;
					background-color: #FFFFFF;
					line-height: 36px;
				}
				.loginFormDiv>ul>li>span>input.switch{
					position: absolute;
					right: 65px;
					top: 37px;
				}
				.loginFormDiv>button{
					width: 94%;
				    height: 40px;
				    background-color: #3697F7;
				    box-shadow: 0px 0px 3px #333333;
				    border: 1px #3697F7 solid;
				    box-shadow: inset 0px 0px 3px #999999;
				    display: block;
				    margin: 0 auto;
				    margin-top: 35px;
				    outline: none;
				    color: #FFFFFF;
				    font-size: 17px;
				    line-height: 40px;
				    font-weight: 600;
				    transition: background-color 0.25s;
				    -webkit-transition: background-color 0.25s;
				    border-radius: 3px;
				}
				.loginFormDiv>button:active{
					background-color: #2A5CB1;
				}
				.userName.listInput,.passWord.listInput{
					height: 17px;
				    line-height: 22px;
				    box-sizing: content-box;
				    padding-top: 15px;
				    padding-bottom: 15px;
				}
			</style>
			<header class="header">
				<h4>移动管理系统</h4>
				<a style="visibility: hidden;"></a>
				<a class="help"><span class="glyphicon glyphicon-info-sign"></span></a>
			</header>
			<div class="loginFormDiv">
				<ul class="list">
					<li>
						账号
						<input class="userName listInput" type="text" placeholder="请输入账号" />
					</li>
					<li>
						密码
						<input class="passWord listInput" type="password" placeholder="请输入密码"/>
					</li>
					<li>
						自动登录
						<span>
							<input type="checkbox" class="switch"/>
						</span>
					</li>
				</ul>
				<button>登录</button>
			</div>
		</div>
		<script>
			loadJs("jquery-1.7.2",function(){
				var jsList=["isPC","common","saveHTML"];
				loadJsM(jsList,function(){
					$.saveHTMLInit();
					$.deleteHTML();
					loadJs("openPage",function(){
						
						function isWeiXin(){
						    var ua = window.navigator.userAgent.toLowerCase();
						    if(ua.match(/MicroMessenger/i) == 'micromessenger'){
						        return true;
						    }else{
						        return false;
						    }
						}
						$.isWeiXin=isWeiXin();
						if($.isWeiXin&&$.isAndroid){
							$("#ifWxStyle").remove();
						}
						if(!$.isAndroid)
							$("#androidTransitionStyle").remove();
		//				$.preLoadPage("index.html");
		//				$.preLoadPage("option.html");
		//				$.preLoadPage("menu.html");
		//				$.preLoadPage("confirm.html");
		//				$.preLoadPage("payment.html");
		//				$.preLoadPage("checkedRoom.html");
		//				$.preLoadPage("packageDetails.html");
		//				$.preLoadPage("remarks.html");
						$.init=function(){
							loadJsM(["createConfirmBox","sendSatateAjax"],function(){
								if($("foot").length==2){
									$("foot:eq(1)").remove();
								}
								$.ajaxSetup({cache:false});
								$(".userName").val(localStorage.getItem("userName"));
								$(".passWord").val(localStorage.getItem("passWord"));
								if(!!localStorage.getItem("userName")){
									$(".loginFormDiv>ul>li>span>input.switch")[0].checked=true;
								}
								
								$.tap(".loginFormDiv>button",function(){
									var username=$(".userName").val();
									var password=$(".passWord").val();
									if(!username||!password){
										$.createConfirmBoxOK({"title":"系统提示","content":"账号及密码不能为空"});
										return;
									}
									$(".loading").css("display","block");
									sendLogin(username,password,function(str){
										$.data_currentUserId=$(str).text();
										if(isNaN($.data_currentUserId)||str=="null"||str==null){
											$(".loading").css("display","none");
											$.createConfirmBoxOK({"title":"系统提示","content":"账号或密码错误"});
											return;
										}
										if(!!$(".loginFormDiv>ul>li>span>input.switch")[0].checked){
											localStorage.setItem("userName",username);
											localStorage.setItem("passWord",password);
										}else{
											localStorage.removeItem("userName");
											localStorage.removeItem("passWord");
										}
										try{
											window.plus.login(username,password);
										}catch(e){}
										$.updateState("已登录");
										$.initOpenPage();
										$(".loading").css("display","none");
										window.location.href="#main.html";
									});
								});
								$.tap(".help",function(){
									try{
										window.plus.helpUse();
									}catch(e){
										$.altAuto("该环境不支持");
									}
								});
								
								function toBKLogin(){
									window.setTimeout(function(){
										var hash=window.location.hash;
										$(window).off("hashchange").on("hashchange",function(){
											window.location.hash=hash;
											window.setTimeout(function(){
												$.createConfirmBox({"title":"系统提示","content":"是否确认退出?","click":function(){
													try{
														window.plus.finish();
													}catch(e){
														$.altAuto("退出");
														$(window).off("hashchange");
													}
												},"cancel":function(){
													toBKLogin();
												}});
											},100);
										});
									},100);
								}
								toBKLogin();
								
								if(!$.data_ktvId){
									sendGetDogName(function(str){
										$.data_ktvId=$(str).find("DocumentElement>KtvInit>Ktvid").text();
										$.data_dogName=$(str).find("DocumentElement>KtvInit>DogName").text();
										try{
											window.plus.saveValueWithKey("ktvId",$.data_ktvId);
										}catch(e){}
									});	
								}
								function sendLogin(username,password,parseDataFn){
									$.ajax({
										type:"get",
										url:"xml/StaffLogin.xml",
										data:"url="+encodeURIComponent("StaffLogin/"+username+","+password)+"&method=get",
										dataType:"text",
										success:function(str){
											parseDataFn(str);
										},
										error:function(){
											$.alt("登录失败!");
										}
									});
								}
								function sendGetDogName(parseDataFn){
									$.ajax({
										type:"get",
										url:"xml/KtvInit.xml",
										data:"url="+encodeURIComponent("KtvInit")+"&method=get",
										dataType:"text",
										success:function(str){
											parseDataFn(str);
										},
										error:function(xhr){
											$.alt("获取加密狗失败!");
										}
									});
								}
								window.sendState=function(stateName,describe){
									$.updateState(stateName,describe);
								}
							});
						}
						$.init();
					});
				});
			});
		
		
			
		</script>
	</body>
	<foot>
		<div class="confirmBox">
			<div>
				<span></span>
				<span></span>
				<div>
					<span>是</span>
					<span>否</span>
				</div>
			</div>
		</div>
		<div class="confirmBoxInput">
			<div>
				<span></span>
				<span></span>
				<input type="text" placeholder="" />
				<div>
					<span>是</span>
					<span>否</span>
				</div>
			</div>
		</div>
		<div class="confirmBoxInputNumber">
			<div>
				<span></span>
				<span></span>
				<input type="number" readonly="readonly" placeholder="" />
				<ul>
					<li>1</li>
					<li>2</li>
					<li>3</li>
					<li>4</li>
					<li>5</li>
					<li>6</li>
					<li>7</li>
					<li>8</li>
					<li>9</li>
					<li class="confirmBoxInputNumberOK"><span class="glyphicon glyphicon-ok"></span></li>
					<li>0</li>
					<li class="confirmBoxInputNumberBackspace"><span class="glyphicon glyphicon-arrow-left"></span></li>
				</ul>
			</div>
		</div>
		<div class="confirmBoxOK">
			<div>
				<span></span>
				<span></span>
				<div>
					<span>是</span>
				</div>
			</div>
		</div>
		<div class="loading" style="display: none;"></div>
		<div class="tip" style="display: none;"></div>
		<div class="bottomList">
			<ul>
				<li>取消</li>
			</ul>
		</div>
	</foot>
</html>
