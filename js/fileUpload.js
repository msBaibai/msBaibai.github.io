$.fn.upload=function(q,l,m,n,p){var a=null,d=document.createElement("div"),c=document.createElement("div"),h=document.createElement("div"),f=document.createElement("span");d.id="supplement_fileUpload";$("#supplement_fileUpload").remove();$(this).unbind("click");with(d.style)width="80%",height="50px",position="fixed",background="linear-gradient(to bottom,#B9B9B9 0,#747474 100%)",right=left="0px",margin="0 auto",top="-50px",textAlign="center",lineHeight="50px",borderBottomRightRadius=borderBottomLeftRadius=
"10px",transition="all .5s";with(c.style)width="90%",height="20px",background="linear-gradient(to bottom,#504C4C 0,#7E7D7D 100%)",margin="0 auto",lineHeight="50px",marginTop="15px",paddingRight=paddingLeft="5px",borderRadius="10px";with(h.style)width="0%",height="10px",background="linear-gradient(to bottom,#83B9FD 0,#4D61A0 100%)",position="relative",top="5px",borderRadius="10px";with(f.style)fontFamily="\u5fae\u8f6f\u96c5\u9ed1",position="absolute",right=left="0px",margin="0 auto",color="#ffffff",
top="0px",fontSize="14px",fontWeight="bold",webkitUserSelect=userSelect="none";f.innerHTML="0%";c.appendChild(h);c.appendChild(f);d.appendChild(c);document.body.appendChild(d);$(this).click(function(){a=document.createElement("input");a.type="file";a.multiple=$(this).attr("multiple");a.accept=$(this).attr("accept");var c=$(this).attr("fileName");a.onchange=function(){if(0!=a.files.length&&(!n||!1!==n(a))){var e=new FormData,g;for(g in a.files)if(a.files.hasOwnProperty(g)&&!isNaN(g)){var k=a.files[g];
c?e.append("fileName",c):e.append("fileName",k.name);e.append("fileSize",k.size);e.append("file",k);p&&p(e,g,a.files)}var b=new XMLHttpRequest;b.open("POST",q,!0);b.onload=function(a){4==b.readyState&&200==b.status&&(d.style.top="-50px",l&&l(b));500==b.status&&m&&m(b)};b.upload.onprogress=function(a){a=parseInt(a.loaded/a.totalSize*100);f.innerHTML=a+"%";h.style.width=a+"%";100==a&&(f.innerHTML="\u670d\u52a1\u5668\u6b63\u5728\u5904\u7406\u4e2d...")};d.style.top="0px";b.send(e)}};a.click()})};